generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Nationality {
  EMIRATI
  OTHER
}

model User {
  id                  String          @id @unique @default(uuid())
  name                String
  email               String
  emailVerified       Boolean
  image               String?
  createdAt           DateTime
  updatedAt           DateTime
  settings            Json?
  role                String?
  banned              Boolean?
  banReason           String?
  banExpires          Int?
  nationality         Nationality?    @default(OTHER)
  sessions            Session[]
  accounts            Account[]
  bookings            Bookings[]
  orders              Orders[]
  notifications       Notifications[]
  phoneNumber         String?
  phoneNumberVerified Boolean?
  Reviews             Reviews[]

  @@unique([email])
  @@unique([phoneNumber])
  @@map("user")
}

model Session {
  id             String   @id @unique @default(uuid())
  expiresAt      DateTime
  token          String
  createdAt      DateTime
  updatedAt      DateTime
  ipAddress      String?
  userAgent      String?
  userId         String
  impersonatedBy String?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id @unique @default(uuid())
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Verification {
  id         String    @id @unique @default(uuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Projects {
  id          String     @id @unique @default(uuid())
  headline    String
  description String
  images      String[]
  address     String
  date        DateTime
  inApp       Boolean    @default(false)
  htmlContent Json
  services    Services[]
  areas       Areas[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Services {
  id               String     @id @unique @default(uuid())
  name             String
  nameAr           String?
  description      String
  descriptionAr    String?
  pastJobs         Int
  serviceCardImage String?
  inApp            Boolean    @default(false)
  Projects         Projects[]
  company          Company[]
  bookings         Bookings[]
  orders           Orders[]
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
}

model Areas {
  id        String     @id @unique @default(uuid())
  name      String
  nameAr    String?
  areaImage String?
  inApp     Boolean    @default(false)
  Projects  Projects[]
  Bookings  Bookings[]
  Orders    Orders[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Faq {
  id         String   @id @unique @default(uuid())
  question   String
  questionAr String?
  answer     String
  answerAr   String?
  inApp      Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Company {
  id             String     @id @unique @default(uuid())
  name           String
  nameAr         String?
  logo           String?
  phoneNumbers   String[]
  emailAddresses String[]
  addresses      String[]
  services       Services[]
  pastBookings   Bookings[]
  orders         Orders[]
  totalEarnings  Float?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

enum BookingStatus {
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

model Bookings {
  id                 String        @id @unique @default(uuid())
  clientId           String
  client             User          @relation(fields: [clientId], references: [id], onDelete: Cascade)
  services           Services[]
  areas              Areas[]
  issueDescription   String
  attachments        String[]
  address            String
  schedule           DateTime
  contactNumber      String
  companyId          String
  company            Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  bookingPrice       Float
  status             BookingStatus @default(UPCOMING)
  notes              Json?
  cancellationReason String?
  clientReview       Reviews?      @relation(fields: [reviewId], references: [id])
  reviewId           String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
}

enum OrderStatus {
  WAITING_QUOTE
  WAITING_APPROVAL
  REJECTED
  CANCELLED
  APPROVED
}

enum OrderType {
  NEW
  EXISTING
}

model Orders {
  id               String      @id @unique @default(uuid())
  clientId         String
  client           User        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  services         Services[]
  areas            Areas[]
  issueDescription String
  attachments      String[]
  address          String
  schedule         DateTime
  contactNumber    String
  companyId        String?
  company          Company?    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  quote            Float?
  status           OrderStatus @default(WAITING_QUOTE)
  boq              Json? // boq is the bill of quantities
  type             OrderType   @default(NEW)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
}

enum NotificationType {
  SAYENLY
  REMINDER
  QUOTE
}

model Notifications {
  id        String           @id @unique @default(uuid())
  userId    String
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  message   String
  read      Boolean          @default(false)
  type      NotificationType
  route     Json?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}

model Reviews {
  id        String     @id @unique @default(uuid())
  clientId  String
  client    User       @relation(fields: [clientId], references: [id], onDelete: Cascade)
  rating    Int
  review    String
  Bookings  Bookings[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}
